From 77cda4dbda989789a7bd8b3b568ac5130faca69e Mon Sep 17 00:00:00 2001
From: Aman-Surkar <aman_surkar@persistent.com>
Date: Wed, 4 Oct 2023 05:30:22 +0000
Subject: [PATCH] Use central cuda capabilities

---
 cmake/Utils.cmake | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/cmake/Utils.cmake b/cmake/Utils.cmake
index 08050205..4ea974d7 100644
--- a/cmake/Utils.cmake
+++ b/cmake/Utils.cmake
@@ -92,6 +92,13 @@ function(format_gencode_flags flags out)
   if(NOT flags)
     if (CUDA_VERSION VERSION_GREATER_EQUAL "11.8")
       set(flags "50;60;70;80;90")
+    elseif (CUDA_VERSION VERSION_GREATER_EQUAL "11.4")
+      string(REPLACE "," ";" tmpflags "$ENV{cuda_levels}")
+      string(REPLACE "." "" flags "${tmpflags}")
+    elseif (CUDA_VERSION VERSION_GREATER_EQUAL "11.1")
+      #set(flags "52;60;61;70;75;80;86")
+      string(REPLACE "," ";" tmpflags "$ENV{cuda_levels}")
+      string(REPLACE "." "" flags "${tmpflags};8.6")
     elseif (CUDA_VERSION VERSION_GREATER_EQUAL "11.0")
       set(flags "50;60;70;80")
     elseif(CUDA_VERSION VERSION_GREATER_EQUAL "10.0")
@@ -101,6 +108,7 @@ function(format_gencode_flags flags out)
     else()
       set(flags "35;50;60")
     endif()
+    message(STATUS "Using Open-CE Centralized CUDA Capabilities: ${flags}")
   endif()
 
   if (CMAKE_VERSION VERSION_GREATER_EQUAL "3.18")
-- 
2.40.1

